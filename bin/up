#!/bin/zsh
set -exv
setopt jobs

cd
yadm pull

case $OSTYPE:l in
    linux*)
        sudo apt update -qq &
        ;;

    darwin*)
        brew update >/dev/null &
        ;;
esac

#if [[ ${+functions[zplug]} ]]; then
#    zplug update
#    zsh-clean-cache
#fi

vim=${commands[nvim]-${commands[vim]}}
if [[ -n $vim ]]; then
    $vim -c 'Update'
fi

#if [[ ${+commands[tmux]} ]]; then
#    :
#fi

wait

if [[ -n "$GOPATH" ]]; then
    go get -u -x -v all
fi

case $OSTYPE:l in
    linux*)
        sudo apt full-upgrade -y
        ;;

    darwin*)
        brew upgrade

        # reinstall all HEAD versions
        brew list --versions | grep HEAD | awk '{ print $1 }' | xargs -t -- brew reinstall --HEAD
        ;;
esac

